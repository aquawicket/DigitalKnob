include(${DKCMAKE_FUNCTIONS_DIR}/DK.cmake)
dk_validate(HOST_TRIPLE "dk_getHostTriple()")
dk_validate(TARGET_TRIPLE "dk_getTargetTriple()")
# https://github.com/LibVNC/libvncserver.git


### DEPEND ###
APPLE_dk_depend(gnutls)
dk_depend(libjpeg-turbo)
dk_depend(libpng)
dk_depend(libsystemd-dev)
dk_depend(openssl)
dk_depend(sdl)
dk_depend(zlib)


### IMPORT ###
#dk_import(https://github.com/LibVNC/libvncserver.git)
dk_import(https://github.com/LibVNC/libvncserver/archive/refs/heads/master.zip)

### LINK ###
dk_include				(${LIBVNCSERVER})
dk_include				(${LIBVNCSERVER}/include)
dk_include				(${LIBVNCSERVER}/examples)
dk_include				(${LIBVNCSERVER}/${OS})
dk_include				(${LIBVNCSERVER}/${triple}/include)
DEBUG_dk_include		(${LIBVNCSERVER}/${triple}/${DEBUG_DIR})
RELEASE_dk_include		(${LIBVNCSERVER}/${triple}/${RELEASE_DIR})
DEBUG_dk_include		(${LIBVNCSERVER}/${triple}/${DEBUG_DIR}/include)
RELEASE_dk_include		(${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/include)

# vncserver
if(MSVC)
	dk_libDebug		(${LIBVNCSERVER}/${triple}/${DEBUG_DIR}/vncserver.lib)
	dk_libRelease	(${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/vncserver.lib)
else()
	dk_libDebug		(${LIBVNCSERVER}/${triple}/${DEBUG_DIR}/libvncserver.a)
	dk_libRelease	(${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/libvncserver.a)
endif()

# vncclient
if(MSVC)
	dk_libDebug		(${LIBVNCSERVER}/${triple}/${DEBUG_DIR}/vncclient.lib)
	dk_libRelease	(${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/vncclient.lib)
else()
	dk_libDebug		(${LIBVNCSERVER}/${triple}/${DEBUG_DIR}/libvncclient.a)
	dk_libRelease	(${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/libvncclient.a)
endif()


### 3RDPARTY LINK ###
ANDROID_DEBUG_dk_set		(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${DEBUG_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${DEBUG_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${triple}/${DEBUG_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${triple}/${DEBUG_DIR}/libvncclient.a)
ANDROID_RELEASE_dk_set		(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${RELEASE_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${RELEASE_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/libvncclient.a)
APPLE_dk_set				(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/libvncclient.a)
EMSCRIPTEN_DEBUG_dk_set		(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${DEBUG_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${DEBUG_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${triple}/${DEBUG_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${triple}/${DEBUG_DIR}/libvncclient.a)
EMSCRIPTEN_RELEASE_dk_set	(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${RELEASE_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${RELEASE_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/libvncclient.a)
LINUX_DEBUG_dk_set			(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${DEBUG_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${DEBUG_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${triple}/${DEBUG_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${triple}/${DEBUG_DIR}/libvncclient.a)
LINUX_RELEASE_dk_set		(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${RELEASE_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${RELEASE_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/libvncclient.a)
RASPBERRY_DEBUG_dk_set		(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${DEBUG_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${DEBUG_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${triple}/${DEBUG_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${triple}/${DEBUG_DIR}/libvncclient.a)
RASPBERRY_RELEASE_dk_set	(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${RELEASE_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${RELEASE_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/libvncclient.a)
if(MSVC)
	WIN_dk_set				(LIBVNCSERVER_CMAKE "/DCMAKE_C_FLAGS=/I${LIBVNCSERVER} /I${LIBVNCSERVER}/${OS}" "/DCMAKE_CXX_FLAGS=/I${LIBVNCSERVER} /I${LIBVNCSERVER}/${OS}" /DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} /DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/vncserver.lib /DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/vncclient.lib)
else()
	WIN_dk_set				(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}" "-DCMAKE_CXX_FLAGS==I${LIBVNCSERVER} =I${LIBVNCSERVER}/${OS}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/vncserver.lib -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${triple}/${RELEASE_DIR}/vncclient.lib)
endif()

### GENERATE ###
ANDROID_DEBUG_dk_configure		(${LIBVNCSERVER} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${DEBUG_DIR}" ${LIBJPEG_TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON)
ANDROID_RELEASE_dk_configure	(${LIBVNCSERVER} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${RELEASE_DIR}" ${LIBJPEG_TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON)
APPLE_dk_configure				(${LIBVNCSERVER} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER}" ${LIBJPEG_TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON -DWITH_LZO=OFF)
EMSCRIPTEN_DEBUG_dk_configure	(${LIBVNCSERVER} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${DEBUG_DIR}" ${LIBJPEG_TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON)
EMSCRIPTEN_RELEASE_dk_configure	(${LIBVNCSERVER} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${RELEASE_DIR}" ${LIBJPEG_TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON)
LINUX_DEBUG_dk_configure		(${LIBVNCSERVER} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${DEBUG_DIR}" ${LIBJPEG_TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON)
LINUX_RELEASE_dk_configure		(${LIBVNCSERVER} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${RELEASE_DIR}" ${LIBJPEG_TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON)
RASPBERRY_DEBUG_dk_configure	(${LIBVNCSERVER} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${DEBUG_DIR}" ${LIBJPEG_TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON)
RASPBERRY_RELEASE_dk_configure	(${LIBVNCSERVER} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/${RELEASE_DIR}" ${LIBJPEG_TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON)

if(MSVC)
	WIN_dk_configure			(${LIBVNCSERVER} "/DCMAKE_C_FLAGS=/I${LIBVNCSERVER} /I${LIBVNCSERVER}/${triple}/include" ${LIBJPEG_TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} /DWITH_JPEG=ON)
else()
	WIN_dk_configure			(${LIBVNCSERVER} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${triple}/include" ${LIBJPEG_TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON)
endif()

### PATCH ###
if(APPLE OR EMSCRIPTEN)
	dk_fileReplace(${LIBVNCSERVER}/${BUILD_DIR}/rfb/rfbconfig.h "\n#include <unistd.h>" "")
	dk_fileReplace(${LIBVNCSERVER}/${BUILD_DIR}/rfb/rfbconfig.h "UNISTD_H  1" "UNISTD_H  1 \n#include <unistd.h>")
endif()


### COMPILE ###
dk_build(${LIBVNCSERVER} vncserver)
dk_build(${LIBVNCSERVER} vncclient)
