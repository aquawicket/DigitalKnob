# https://github.com/LibVNC/libvncserver.git


### DEPEND ###
APPLE_dk_depend(gnutls)
dk_depend(libjpeg-turbo)
dk_depend(libpng)
dk_depend(libsystemd-dev)
dk_depend(openssl)
dk_depend(sdl)
dk_depend(zlib)


### IMPORT ###
dk_import(https://github.com/LibVNC/libvncserver.git)


### LINK ###
dk_include						(${LIBVNCSERVER})
dk_include						(${LIBVNCSERVER}/examples)
dk_include						(${LIBVNCSERVER}/${OS})
LINUX_DEBUG_dk_include			(${LIBVNCSERVER}/${OS}/${DEBUG_DIR})
LINUX_RELEASE_dk_include		(${LIBVNCSERVER}/${OS}/${RELEASE_DIR})
RASPBERRY_DEBUG_dk_include		(${LIBVNCSERVER}/${OS}/${DEBUG_DIR})
RASPBERRY_RELEASE_dk_include	(${LIBVNCSERVER}/${OS}/${RELEASE_DIR})
EMSCRIPTEN_DEBUG_dk_include		(${LIBVNCSERVER}/${OS}/${DEBUG_DIR})
EMSCRIPTEN_RELEASE_dk_include	(${LIBVNCSERVER}/${OS}/${RELEASE_DIR})

# vncserver
WIN_dk_libDebug				(${LIBVNCSERVER}/${OS}/${DEBUG_DIR}/vncserver.lib)
WIN_dk_libRelease			(${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/vncserver.lib)
UNIX_dk_libDebug			(${LIBVNCSERVER}/${OS}/${DEBUG_DIR}/libvncserver.a)
UNIX_dk_libRelease			(${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/libvncserver.a)

# vncclient
WIN_dk_libDebug				(${LIBVNCSERVER}/${OS}/${DEBUG_DIR}/vncclient.lib)
WIN_dk_libRelease			(${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/vncclient.lib)
UNIX_dk_libDebug			(${LIBVNCSERVER}/${OS}/${DEBUG_DIR}/libvncclient.a)
UNIX_dk_libRelease			(${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/libvncclient.a)



### 3RDPARTY LINK ###
ANDROID_DEBUG_dk_set		(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${DEBUG_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${DEBUG_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${OS}/${DEBUG_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${OS}/${DEBUG_DIR}/libvncclient.a)
ANDROID_RELEASE_dk_set		(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${RELEASE_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${RELEASE_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/libvncclient.a)
APPLE_dk_set				(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/libvncclient.a)
EMSCRIPTEN_DEBUG_dk_set		(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${DEBUG_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${DEBUG_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${OS}/${DEBUG_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${OS}/${DEBUG_DIR}/libvncclient.a)
EMSCRIPTEN_RELEASE_dk_set	(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${RELEASE_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${RELEASE_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/libvncclient.a)
LINUX_DEBUG_dk_set			(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${DEBUG_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${DEBUG_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${OS}/${DEBUG_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${OS}/${DEBUG_DIR}/libvncclient.a)
LINUX_RELEASE_dk_set		(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${RELEASE_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${RELEASE_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/libvncclient.a)
RASPBERRY_DEBUG_dk_set		(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${DEBUG_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${DEBUG_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${OS}/${DEBUG_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${OS}/${DEBUG_DIR}/libvncclient.a)
RASPBERRY_RELEASE_dk_set	(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${RELEASE_DIR}" "-DCMAKE_CXX_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${RELEASE_DIR}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/libvncserver.a -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/libvncclient.a)
WIN_dk_set					(LIBVNCSERVER_CMAKE "-DCMAKE_C_FLAGS=/I${LIBVNCSERVER} /I${LIBVNCSERVER}/${OS}" "-DCMAKE_CXX_FLAGS=/I${LIBVNCSERVER} /I${LIBVNCSERVER}/${OS}" -DLIBVNCSERVER_INCLUDE_DIR=${LIBVNCSERVER} -DLIBVNCSERVER_LIBRARY=${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/vncserver.lib -DLIBVNCCLIENT_LIBRARY=${LIBVNCSERVER}/${OS}/${RELEASE_DIR}/vncclient.lib)


### GENERATE ###
ANDROID_DEBUG_dk_queueCommand		(${DKCMAKE_BUILD} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${DEBUG_DIR}" ${LIBJPEG-TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON ${LIBVNCSERVER})
ANDROID_RELEASE_dk_queueCommand		(${DKCMAKE_BUILD} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${RELEASE_DIR}" ${LIBJPEG-TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON ${LIBVNCSERVER})
APPLE_dk_queueCommand				(${DKCMAKE_BUILD} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER}" ${LIBJPEG-TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON -DWITH_LZO=OFF ${LIBVNCSERVER})
EMSCRIPTEN_DEBUG_dk_queueCommand	(${DKCMAKE_BUILD} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${DEBUG_DIR}" ${LIBJPEG-TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON ${LIBVNCSERVER})
EMSCRIPTEN_RELEASE_dk_queueCommand	(${DKCMAKE_BUILD} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${RELEASE_DIR}" ${LIBJPEG-TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON ${LIBVNCSERVER})
LINUX_DEBUG_dk_queueCommand			(${DKCMAKE_BUILD} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${DEBUG_DIR}" ${LIBJPEG-TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON ${LIBVNCSERVER})
LINUX_RELEASE_dk_queueCommand		(${DKCMAKE_BUILD} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${RELEASE_DIR}" ${LIBJPEG-TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON ${LIBVNCSERVER})
RASPBERRY_DEBUG_dk_queueCommand		(${DKCMAKE_BUILD} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${DEBUG_DIR}" ${LIBJPEG-TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON ${LIBVNCSERVER})
RASPBERRY_RELEASE_dk_queueCommand	(${DKCMAKE_BUILD} "-DCMAKE_C_FLAGS=-I${LIBVNCSERVER} -I${LIBVNCSERVER}/${OS}/${RELEASE_DIR}" ${LIBJPEG-TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON ${LIBVNCSERVER})
WIN_dk_queueCommand					(${DKCMAKE_BUILD} "-DCMAKE_C_FLAGS=/I${LIBVNCSERVER}" ${LIBJPEG-TURBO_CMAKE} ${LIBPNG_CMAKE} ${OPENSSL_CMAKE} ${SDL_CMAKE} ${ZLIB_CMAKE} -DWITH_JPEG=ON ${LIBVNCSERVER})


### PATCH ###
if(APPLE OR EMSCRIPTEN)
	dkFileReplace(${LIBVNCSERVER}/${BUILD_DIR}/rfb/rfbconfig.h "\n#include <unistd.h>" "")
	dkFileReplace(${LIBVNCSERVER}/${BUILD_DIR}/rfb/rfbconfig.h "UNISTD_H  1" "UNISTD_H  1 \n#include <unistd.h>")
endif()


### COMPILE ###
dk_build(${LIBVNCSERVER_FOLDER} vncserver)
dk_build(${LIBVNCSERVER_FOLDER} vncclient)
