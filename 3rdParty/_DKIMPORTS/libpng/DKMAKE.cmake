# https://github.com/glennrp/libpng
# http://www.libpng.org/pub/png/libpng.html


### DEPEND ###
dk_depend(zlib)


### IMPORT ###
if(MAC)
	dk_import(https://github.com/glennrp/libpng.git)
else()
	dk_import(https://github.com/glennrp/libpng/archive/refs/tags/v1.6.35.zip)
	dk_set(LIBPNG_MAJOR 1)
	dk_set(LIBPNG_MINOR 6)
	dk_set(LIBPNG_BUILD 35)
endif()


### LINK ###
dk_define				(PNG_STATIC)
dk_include				(${LIBPNG})
dk_include				(${LIBPNG}/${OS})
dk_include				(${LIBPNG}/${OS}/${RELEASE_DIR})
ANDROID_dk_include		(${LIBPNG}/${OS}/$(BUILD_TYPE)/jni)
if(VISUAL_STUDIO_IDE)
	WIN_dk_libDebug			(${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}_staticd.lib)
	WIN_dk_libRelease		(${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}_static.lib)
	ANDROID_dk_libDebug		(${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a)
	ANDROID_dk_libRelease	(${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
elseif(XCODE_IDE)
	dk_libDebug			(${LIBPNG}/${OS}/${DEBUG_DIR}/libpng.a)
	dk_libRelease		(${LIBPNG}/${OS}/${RELEASE_DIR}/libpng.a)
else()
	if(ANDROID)
		dk_libDebug			(${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
	else()
		dk_libDebug			(${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a)
	endif()
	dk_libRelease		(${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
endif()


### 3RDPARTY LINK ###
WIN_dk_set				(LIBPNG_CMAKE "-DCMAKE_C_FLAGS=/I${LIBPNG} /I${LIBPNG}/${OS}" "-DCMAKE_CXX_FLAGS=/I${LIBPNG} /I${LIBPNG}/${OS}" -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_PNG_INCLUDE_DIR=${LIBPNG}/${OS} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}_staticd.lib -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}_static.lib)
APPLE_dk_set			(LIBPNG_CMAKE "-DCMAKE_C_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}" "-DCMAKE_CXX_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}" -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
LINUX_DEBUG_dk_set		(LIBPNG_CMAKE "-DCMAKE_C_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Debug" "-DCMAKE_CXX_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Debug" -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS}/${DEBUG_DIR} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
LINUX_RELEASE_dk_set	(LIBPNG_CMAKE "-DCMAKE_C_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Release" "-DCMAKE_CXX_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Release" -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS}/${RELEASE_DIR} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
RASPBERRY_DEBUG_dk_set	(LIBPNG_CMAKE "-DCMAKE_C_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Debug" "-DCMAKE_CXX_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Debug" -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
RASPBERRY_RELEASE_dk_set(LIBPNG_CMAKE "-DCMAKE_C_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Release" "-DCMAKE_CXX_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Release" -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
if(VISUAL_STUDIO_IDE)
	ANDROID_dk_set			(LIBPNG_CMAKE "-DCMAKE_C_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}" "-DCMAKE_CXX_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}" -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_PNG_INCLUDE_DIR=${LIBPNG}/${OS} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
#else()
	#ANDROID_DEBUG_dk_set	(LIBPNG_CMAKE "-DCMAKE_C_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Debug" "-DCMAKE_CXX_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Debug" -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS}/${DEBUG_DIR} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
	#ANDROID_RELEASE_dk_set	(LIBPNG_CMAKE "-DCMAKE_C_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Release" "-DCMAKE_CXX_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Release" -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS}/${RELEASE_DIR} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
endif()
EMSCRIPTEN_DEBUG_dk_set		(LIBPNG_CMAKE "-DCMAKE_C_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Debug" "-DCMAKE_CXX_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Debug" -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS}/${DEBUG_DIR} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
EMSCRIPTEN_RELEASE_dk_set	(LIBPNG_CMAKE "-DCMAKE_C_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Release" "-DCMAKE_CXX_FLAGS=-I${LIBPNG} -I${LIBPNG}/${OS}/Release" -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS}/${RELEASE_DIR} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)

### GENERATE ###
if(MAC_HOST)
	dk_queueCommand(${DKCMAKE_BUILD} -DPNG_STATIC=ON -DPNG_SHARED=OFF -DPNG_TESTS=OFF ${ZLIB_CMAKE} ${LIBPNG})
else()
	dk_queueCommand(${DKCMAKE_BUILD} -DPNG_STATIC=ON -DPNG_SHARED=OFF -DPNG_TESTS=OFF -DSKIP_INSTALL_LIBRARIES=ON -DSKIP_INSTALL_ALL=ON ${ZLIB_CMAKE} ${LIBPNG})
endif()


### COMPILE ###
#if(PNG_MINOR LESS 7)
	dk_build(${LIBPNG_FOLDER} png_static)
#else()
#	dk_build(${LIBPNG_FOLDER} png${LIBPNG_MAJOR}${LIBPNG_MINOR}_static)
#endif()
