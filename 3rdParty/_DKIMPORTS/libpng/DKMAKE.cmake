# https://github.com/glennrp/libpng
# http://www.libpng.org/pub/png/libpng.html


DKDEPEND(zlib)

if(MAC)
	dk_import(https://github.com/glennrp/libpng.git)
else()
	dk_import(https://github.com/glennrp/libpng/archive/refs/tags/v1.6.35.zip)
	dk_set(LIBPNG_MAJOR 1)
	dk_set(LIBPNG_MINOR 6)
	dk_set(LIBPNG_BUILD 35)
	#dk_set(LIBPNG_VERSION ${LIBPNG_MAJOR}.${LIBPNG_MINOR}.${LIBPNG_BUILD})
	#dk_set(LIBPNG_NAME libpng-${LIBPNG_VERSION})
	#dk_set(LIBPNG_DL https://github.com/glennrp/libpng/archive/refs/tags/v1.6.35.zip)
	#dk_set(LIBPNG ${3RDPARTY}/${LIBPNG_NAME})
	#DKINSTALL(${LIBPNG_DL} libpng ${LIBPNG})
endif()

### DKPLUGINS LINK ###
DKDEFINE(PNG_STATIC)
DKINCLUDE(${LIBPNG})
DKINCLUDE(${LIBPNG}/${OS})
DKINCLUDE(${LIBPNG}/${OS}/${RELEASE_DIR})
ANDROID_DKINCLUDE(${LIBPNG}/${OS}/$(BUILD_TYPE)/jni)
WIN_DEBUG_DKLIB(${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}_staticd.lib)
WIN_RELEASE_DKLIB(${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}_static.lib)
APPLE_DEBUG_DKLIB(${LIBPNG}/${OS}/${DEBUG_DIR}/libpng.a)
APPLE_RELEASE_DKLIB(${LIBPNG}/${OS}/${RELEASE_DIR}/libpng.a)
LINUX_DEBUG_DKLIB(${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a)
LINUX_RELEASE_DKLIB(${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
RASPBERRY_DEBUG_DKLIB(${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a)
RASPBERRY_RELEASE_DKLIB(${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
ANDROID_DEBUG_DKLIB(${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a)
ANDROID_RELEASE_DKLIB(${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)


### 3RDPARTY LINK ###
WIN_dk_set(LIBPNG_CMAKE "-DCMAKE_C_FLAGS=/I${LIBPNG} /I${LIBPNG}/${OS}" -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_PNG_INCLUDE_DIR=${LIBPNG}/${OS} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}_staticd.lib -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}_static.lib)
APPLE_dk_set(LIBPNG_CMAKE -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
LINUX_dk_set(LIBPNG_CMAKE -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS}/${RELEASE_DIR} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
RASPBERRY_dk_set(LIBPNG_CMAKE -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
ANDROID_dk_set(LIBPNG_CMAKE -DPNG_INCLUDE_DIR=${LIBPNG} -DPNG_INCLUDE_DIR2=${LIBPNG}/${OS} -DPNG_LIBRARY_DEBUG=${LIBPNG}/${OS}/${DEBUG_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}d.a -DPNG_LIBRARY_RELEASE=${LIBPNG}/${OS}/${RELEASE_DIR}/libpng${LIBPNG_MAJOR}${LIBPNG_MINOR}.a)
	

### COMPILE ###
DKSETPATH(${LIBPNG}/${BUILD_DIR})


if(MAC_HOST)
	DKQCOMMAND(${DKCMAKE_BUILD} -DPNG_STATIC=ON -DPNG_SHARED=OFF -DPNG_TESTS=OFF ${ZLIB_CMAKE} ${LIBPNG})
else()
	DKQCOMMAND(${DKCMAKE_BUILD} -DPNG_STATIC=ON -DPNG_SHARED=OFF -DPNG_TESTS=OFF -DSKIP_INSTALL_LIBRARIES=ON -DSKIP_INSTALL_ALL=ON ${ZLIB_CMAKE} ${LIBPNG})
endif()




if(PNG_MINOR LESS 7)
	dk_set(PNG_VCPROJ png_static)
else()
	dk_set(PNG_VCPROJ png${LIBPNG_MAJOR}${LIBPNG_MINOR}_static)
endif()

WIN_VS(${LIBPNG_NAME} libpng.sln ${LIBPNG_VCPROJ})
MAC_XCODE(${LIBPNG_NAME} ${LIBPNG_VCPROJ})
IOS_XCODE(${LIBPNG_NAME} ${LIBPNG_VCPROJ})
IOSSIM_XCODE(${LIBPNG_NAME} ${LIBPNG_VCPROJ})
LINUX_DKQCOMMAND(make ${LIBPNG_VCPROJ})
RASPBERRY_DKQCOMMAND(make ${LIBPNG_VCPROJ})
ANDROID_VS(${LIBPNG_NAME} libpng.sln ${LIBPNG_VCPROJ})
