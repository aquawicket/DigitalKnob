# https://developer.android.com/studio?hl=fr#command-tools
# https://androidsdkoffline.blogspot.com/p/android-sdk-cmdline-tools-offline.html
#include(C:/Users/aquawicket/digitalknob/DK/DKCMake/FUNCTIONS.cmake)
return()

if(NOT ANDROID)
	return()
endif()

## DEPENDS ###
#DKDEPEND(jdk)

### VERSION ###
if(CMAKE_HOST_WIN32)
	DKSET(ANDROIDTOOLS_FILE commandlinetools-win-7302050_latest.zip)
	DKSET(ANDROIDTOOLS_DL https://dl.google.com/android/repository/commandlinetools-win-7302050_latest.zip)
endif()
if(CMAKE_HOST_APPLE)
	DKSET(ANDROIDTOOLS_FILE commandlinetools-mac-7302050_latest.zip)
	DKSET(ANDROIDTOOLS_DL https://dl.google.com/android/repository/commandlinetools-mac-7302050_latest.zip)
endif()
if(CMAKE_HOST_LINUX)
	DKSET(ANDROIDTOOLS_FILE commandlinetools-linux-7302050_latest.zip)
	DKSET(ANDROIDTOOLS_DL https://dl.google.com/android/repository/commandlinetools-linux-7302050_latest.zip)
endif()

DKSET(ANDROIDSDK_NAME android-sdk)
DKSET(ANDROIDSDK ${3RDPARTY}/${ANDROIDSDK_NAME})
DKSET(ANDROIDBUILDTOOLS_VERSION 30.0.3)
DKSET(ANDROIDPLATFORM_VERSION android-26)
DKSET(ANDROIDSOURCES_VERSION android-30)
#DKSET(ANDROIDNDK_VERSION r21e)
#DKSET(ANDROIDNDK_BUILD 21.4.7075529)
#DKSET(ANDROIDNDK ${ANDROIDSDK}/ndk/${ANDROIDNDK_BUILD})
DKSET(SDKMANAGER_EXE ${ANDROIDSDK}/cmdline-tools/latest/bin/sdkmanager)

#https://developer.android.com/studio/command-line/variables
DKSETENV("ANDROID_HOME" ${ANDROIDSDK})
#DKSETENV("ANDROID_SDK_ROOT" ${ANDROIDSDK})
#DKSETENV("NDK_ROOT" ${ANDROIDNDK})


### INSTALL ###
if(CMAKE_HOST_WIN32)
	## https://dl.google.com/android/repository/commandlinetools-win-7302050_latest.zip
	DKINSTALL(${ANDROIDTOOLS_DL} android-sdk ${ANDROIDSDK_NAME})
	#ANDROID_PATH(${ANDROIDSDK}/bin)
	if(NOT EXISTS ${ANDROIDSDK}/build-tools/${ANDROIDBUILDTOOLS_VERSION})
		message("Installing Android build-tools: ${ANDROIDBUILDTOOLS_VERSION} . . .")
		DKSET(QUEUE_BUILD ON)
		set(ARGUMNTS "${SDKMANAGER_EXE} --install build-tools\\;${ANDROIDBUILDTOOLS_VERSION} --sdk_root=${ANDROIDSDK}")
		separate_arguments(ARGUMNTS)
		execute_process(COMMAND cmd /c ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	endif()
	if(NOT EXISTS ${ANDROIDSDK}/platforms/${ANDROIDPLATFORM_VERSION})
		message("Installing Android platform: ${ANDROIDPLATFORM_VERSION} . . .")
		DKSET(QUEUE_BUILD ON)
		set(ARGUMNTS "${SDKMANAGER_EXE} --install platforms\\;${ANDROIDPLATFORM_VERSION} --sdk_root=${ANDROIDSDK}")
		separate_arguments(ARGUMNTS)
		execute_process(COMMAND cmd /c ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	endif()
	#if(NOT EXISTS ${ANDROIDNDK})
	#	message("Installing Android NDK: ${ANDROIDNDK_BUILD} . . .")
	#	DKSET(QUEUE_BUILD ON)
	#	set(ARGUMNTS "${SDKMANAGER_EXE} --install ndk\\;${ANDROIDNDK_BUILD} --sdk_root=${ANDROIDSDK}")
	#	separate_arguments(ARGUMNTS)
	#	execute_process(COMMAND cmd /c ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	#	WaitForEnter()
	#endif()
	if(NOT EXISTS ${ANDROIDSDK}/Sources/${ANDROIDSOURCES_VERSION})
		message("Installing Android API Sources: ${ANDROIDSOURCES_VERSION}")
		DKSET(QUEUE_BUILD ON)
		set(ARGUMNTS "${SDKMANAGER_EXE} --install sources\\;${ANDROIDSOURCES_VERSION} --sdk_root=${ANDROIDSDK}")
		separate_arguments(ARGUMNTS)
		execute_process(COMMAND cmd /c ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	endif()
	if(NOT EXISTS ${ANDROIDSDK}/system-images/android-25/google_apis/armeabi-v7a)
		message("Installing Android API Sources: android-25")
		DKSET(QUEUE_BUILD ON)
		set(ARGUMNTS "${SDKMANAGER_EXE} --install system-images\\;android-25\\;google_apis\\;armeabi-v7a --sdk_root=${ANDROIDSDK}")
		separate_arguments(ARGUMNTS)
		execute_process(COMMAND cmd /c ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	endif()
	if(NOT EXISTS ${ANDROIDSDK}/system-images/android-25/google_apis/arm64-v8a)
		message("Installing Android API Sources: android-25")
		DKSET(QUEUE_BUILD ON)
		set(ARGUMNTS "${SDKMANAGER_EXE} --install system-images\\;android-25\\;google_apis\\;arm64-v8a --sdk_root=${ANDROIDSDK}")
		separate_arguments(ARGUMNTS)
		execute_process(COMMAND cmd /c ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	endif()
	if(NOT EXISTS ${ANDROIDSDK}/system-images/android-25/google_apis/x86)
		message("Installing Android API Sources: android-25")
		DKSET(QUEUE_BUILD ON)
		set(ARGUMNTS "${SDKMANAGER_EXE} --install system-images\\;android-25\\;google_apis\\;x86 --sdk_root=${ANDROIDSDK}")
		separate_arguments(ARGUMNTS)
		execute_process(COMMAND cmd /c ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	endif()
	if(NOT EXISTS ${ANDROIDSDK}/system-images/android-25/google_apis/x86_64)
		message("Installing Android API Sources: android-25")
		DKSET(QUEUE_BUILD ON)
		set(ARGUMNTS "${SDKMANAGER_EXE} --install system-images\\;android-25\\;google_apis\\;x86_64 --sdk_root=${ANDROIDSDK}")
		separate_arguments(ARGUMNTS)
		execute_process(COMMAND cmd /c ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	endif()
endif()


if(CMAKE_HOST_APPLE)
	## https://dl.google.com/android/repository/commandlinetools-mac-7302050_latest.zip
	DKINSTALL(https://dl.google.com/android/repository/commandlinetools-mac-7302050_latest.zip android-sdk ${ANDROIDSDK_NAME})
	ANDROID_PATH(${ANDROIDSDK}/bin)
	if(NOT EXISTS ${ANDROIDSDK}/build-tools/${ANDROIDBUILDTOOLS_VERSION})
		message("Installing Android build-tools: ${ANDROIDBUILDTOOLS_VERSION} . . .")
		DKSET(QUEUE_BUILD ON)
		set(ARGUMNTS "${ANDROIDSDK}/bin/sdkmanager --install build-tools\\;${ANDROIDBUILDTOOLS_VERSION} --sdk_root=${ANDROIDSDK}")
		separate_arguments(ARGUMNTS)
		execute_process(COMMAND ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	endif()
	if(NOT EXISTS ${ANDROIDSDK}/platforms/${ANDROIDPLATFORM_VERSION})
		message("Installing Android platform: ${ANDROIDPLATFORM_VERSION} . . .")
		DKSET(QUEUE_BUILD ON)
		set(ARGUMNTS "${ANDROIDSDK}/bin/sdkmanager --install platforms\\;${ANDROIDPLATFORM_VERSION} --sdk_root=${ANDROIDSDK}")
		separate_arguments(ARGUMNTS)
		execute_process(COMMAND ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	endif()
	#if(NOT EXISTS ${ANDROIDNDK})
	#	message("Installing Android NDK: ${ANDROIDNDK_BUILD} . . .")
	#	DKSET(QUEUE_BUILD ON)
	#	set(ARGUMNTS "${ANDROIDSDK}/bin/sdkmanager --install ndk\\;${ANDROIDNDK_BUILD} --sdk_root=${ANDROIDSDK}")
	#	separate_arguments(ARGUMNTS)
	#	execute_process(COMMAND ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	#endif()
	#if(NOT EXISTS ${ANDROIDSDK}/Sources/${ANDROIDSOURCES_VERSION})
	#	message("Installing Android API Sources: ${ANDROIDSOURCES_VERSION}")
	#	DKSET(QUEUE_BUILD ON)
	#	set(ARGUMNTS "${ANDROIDSDK}/bin/sdkmanager --install sources\\;${ANDROIDSOURCES_VERSION} --sdk_root=${ANDROIDSDK}")
	#	separate_arguments(ARGUMNTS)
	#	execute_process(COMMAND ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	##endif()
endif()



if(CMAKE_HOST_LINUX)
	## https://dl.google.com/android/repository/commandlinetools-linux-7302050_latest.zip
	DKINSTALL(https://dl.google.com/android/repository/commandlinetools-linux-7302050_latest.zip android-sdk ${ANDROIDSDK_NAME})
	ANDROID_PATH(${ANDROIDSDK}/bin)
	if(NOT EXISTS ${ANDROIDSDK}/build-tools/${ANDROIDBUILDTOOLS_VERSION})
		message("Installing Android build-tools: ${ANDROIDBUILDTOOLS_VERSION} . . .")
		DKSET(QUEUE_BUILD ON)
		set(ARGUMNTS "${ANDROIDSDK}/bin/sdkmanager --install build-tools\\;${ANDROIDBUILDTOOLS_VERSION} --sdk_root=${ANDROIDSDK}")
		separate_arguments(ARGUMNTS)
		execute_process(COMMAND ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	endif()
	if(NOT EXISTS ${ANDROIDSDK}/platforms/${ANDROIDPLATFORM_VERSION})
		message("Installing Android platform: ${ANDROIDPLATFORM_VERSION} . . .")
		DKSET(QUEUE_BUILD ON)
		set(ARGUMNTS "${ANDROIDSDK}/bin/sdkmanager --install platforms\\;${ANDROIDPLATFORM_VERSION} --sdk_root=${ANDROIDSDK}")
		separate_arguments(ARGUMNTS)
		execute_process(COMMAND ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	endif()
	#if(NOT EXISTS ${ANDROIDNDK})
	#	message("Installing Android NDK: ${ANDROIDNDK_BUILD} . . .")
	#	DKSET(QUEUE_BUILD ON)
	#	set(ARGUMNTS "${ANDROIDSDK}/bin/sdkmanager --install ndk\\;${ANDROIDNDK_BUILD} --sdk_root=${ANDROIDSDK}")
	#	separate_arguments(ARGUMNTS)
	#	execute_process(COMMAND ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	#endif()
	#if(NOT EXISTS ${ANDROIDSDK}/Sources/${ANDROIDSOURCES_VERSION})
	#	message("Installing Android API Sources: ${ANDROIDSOURCES_VERSION}")
	#	DKSET(QUEUE_BUILD ON)
	#	set(ARGUMNTS "${ANDROIDSDK}/bin/sdkmanager --install sources\\;${ANDROIDSOURCES_VERSION} --sdk_root=${ANDROIDSDK}")
	#	separate_arguments(ARGUMNTS)
	#	execute_process(COMMAND ${ARGUMNTS} WORKING_DIRECTORY ${ANDROIDSDK}/bin)
	##endif()
endif()
