# Multi-format archive and compression library
#
# https://libarchive.org/
# https://github.com/libarchive/libarchive
# https://packages.msys2.org/base/libarchive
#
# INSTALL TARGETS given no BUNDLE DESTINATION for MACOSX_BUNDLE executabletarget "bsdcat".
# https://github.com/libarchive/libarchive/issues/1563


### DEPENDS ###
dk_depend(bzip2)
#dk_depend(libb2)
#dk_depend(libbcrypt)
dk_depend(libexpat)
dk_depend(libiconv)
dk_depend(libxml2)
dk_depend(lz4)
dk_depend(lzo)
dk_depend(pcre2)
dk_depend(xz)
dk_depend(zlib)
dk_depend(zstd)


### IMPORT ###
#dk_import(https://github.com/libarchive/libarchive.git BRANCH master TAG a5aac7c9295449dc2fabf36f203f4ff464724ccf PATCH)
dk_import(https://github.com/libarchive/libarchive.git)


### LINK ###
dk_define				(LIBARCHIVE_STATIC)
dk_include				(${LIBARCHIVE}/libarchive)
dk_include				(${LIBARCHIVE}/${OS})
ANDROID_dk_include		(${LIBARCHIVE}/contrib/android/include)

if(MULTI_CONFIG)
	if(MSVC)
		WIN_dk_libDebug		(${LIBARCHIVE}/${OS}/libarchive/${DEBUG_DIR}/archive.lib)
		WIN_dk_libRelease	(${LIBARCHIVE}/${OS}/libarchive/${RELEASE_DIR}/archive.lib)
	else()
		dk_libDebug			(${LIBARCHIVE}/${OS}/libarchive/${DEBUG_DIR}/libarchive.a)
		dk_libRelease		(${LIBARCHIVE}/${OS}/libarchive/${RELEASE_DIR}/libarchive.a)
	endif()
else()
	dk_libDebug		(${LIBARCHIVE}/${OS}/${DEBUG_DIR}/libarchive/libarchive.a)
	dk_libRelease	(${LIBARCHIVE}/${OS}/${RELEASE_DIR}/libarchive/libarchive.a)
endif()


### GENERATE ###
ANDROID_dk_queueCommand(${DKCMAKE_BUILD}
	"-DCMAKE_C_FLAGS=-I${LIBARCHIVE}/${OS} -I${LIBARCHIVE}/contrib/android/include"
	-DBUILD_TESTING=OFF 
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	#-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR}
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=${BZIP2}
	#-DWINDOWS_VERSION=""
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	#${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})

EMSCRIPTEN_dk_queueCommand(${DKCMAKE_BUILD}
	-DBUILD_TESTING=OFF 
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=ON
	#-DWINDOWS_VERSION="WIN10"
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})
	
IOS_dk_queueCommand(${DKCMAKE_BUILD}
	"-DCMAKE_C_FLAGS=-I${LIBARCHIVE}/libarchive" 
	-DBUILD_TESTING=OFF 
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=ON
	#-DWINDOWS_VERSION="WIN10"
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})
if(IOS)
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#include <time.h>\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "typedef int errno_t;\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "typedef time_t __time64_t;\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#undef HAVE__GMTIME64_S\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#undef HAVE__CTIME64_S\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#undef HAVE_FUTIMESAT\n")
endif()

IOSSIM_dk_queueCommand(${DKCMAKE_BUILD}
	"-DCMAKE_C_FLAGS=-I${LIBARCHIVE}/libarchive" 
	-DBUILD_TESTING=OFF 
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=ON
	#-DWINDOWS_VERSION="WIN10"
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})
if(IOSSIM)
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#include <time.h>\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "typedef int errno_t;\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "typedef time_t __time64_t;\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#undef HAVE__GMTIME64_S\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#undef HAVE__CTIME64_S\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#undef HAVE_FUTIMESAT\n")
endif()

LINUX_dk_queueCommand(${DKCMAKE_BUILD}
	-DBUILD_TESTING=OFF 
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=ON
	#-DWINDOWS_VERSION="WIN10"
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})

MAC_dk_queueCommand(${DKCMAKE_BUILD}
	-DBUILD_TESTING=OFF 
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=ON
	#-DWINDOWS_VERSION="WIN10"
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})
	
RASPBERRY_dk_queueCommand(${DKCMAKE_BUILD}
	-DBUILD_TESTING=OFF 
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=ON
	#-DWINDOWS_VERSION="WIN10"
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})

if(MSVC)
	WIN_dk_queueCommand(${DKCMAKE_BUILD}
		-DBUILD_TESTING=OFF 
		-DENABLE_ACL=ON
		-DENABLE_BZip2=${BZIP2}
		-DENABLE_CAT=ON
		-DENABLE_CAT_SHARED=OFF
		-DENABLE_CNG=${LIBBCRYPT}
		-DENABLE_COVERAGE=OFF
		-DENABLE_CPIO=ON
		-DENABLE_CPIO_SHARED=OFF
		-DENABLE_EXPAT=${LIBEXPAT}
		-DENABLE_ICONV=${LIBICONV}
		-DENABLE_INSTALL=OFF
		-DENABLE_LIBB2=${LIBB2} 
		-DENABLE_LIBGCC=${LIBGCC}
		-DENABLE_LIBXML2=${LIBXML2} 
		-DENABLE_LZ4=${LZ4} 
		-DENABLE_LZMA=${XZ}
		-DENABLE_LZO=${LZO}
		-DENABLE_MBEDTLS=OFF
		-DENABLE_NETTLE=OFF
		-DENABLE_OPENSSL=${OPENSSL}
		-DENABLE_PCREPOSIX=OFF
		-DENABLE_SAFESEH="AUTO"
		-DENABLE_TAR=ON
		-DENABLE_TAR_SHARED=OFF
		-DENABLE_TEST=OFF
		-DENABLE_UNZIP=OFF
		-DENABLE_UNZIP_SHARED=OFF
		-DENABLE_WERROR=OFF
		-DENABLE_XATTR=ON
		-DENABLE_ZLIB=${ZLIB}
		-DENABLE_ZSTD=${ZSTD}
		-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR}
		-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR}
		-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR}
		-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES}
		-DLIBXML2_XMLLINT_EXECUTABLE=OFF
		-DPOSIX_REGEX_LIB="AUTO"
		-DUSE_BZIP2_DLL=OFF
		-DUSE_BZIP2_STATIC=ON
		-DWINDOWS_VERSION="WIN10"
		${BZIP2_CMAKE}
		${CRYPTOPP_CMAKE}
		${LIBB2_CMAKE}
		${LIBBCRYPT_CMAKE}
		${LIBEXPAT_CMAKE}
		${LIBICONV_CMAKE}
		${LIBXML2_CMAKE}
		${LZ4_CMAKE}
		${LZO_CMAKE}
		${OPENSSL_CMAKE}
		${PCRE2_CMAKE}
		${XZ_CMAKE}
		${ZLIB_CMAKE}
		${ZSTD_CMAKE}
		${LIBARCHIVE})
else()
	dk_debug("WIN_dk_queueCommand(libarchive)")
	WIN_dk_queueCommand(${DKCMAKE_BUILD}
		"-DCMAKE_C_FLAGS=-DLIBXML_STATIC"
		-DCMAKE_FIND_USE_CMAKE_PATH=FALSE
		-DCMAKE_FIND_USE_CMAKE_ENVIRONMENT_PATH=FALSE
		-DCMAKE_FIND_USE_SYSTEM_ENVIRONMENT_PATH=FALSE
		-DCMAKE_FIND_USE_PACKAGE_REGISTRY=FALSE
		-DCMAKE_FIND_USE_CMAKE_SYSTEM_PATH=FALSE
		-DCMAKE_FIND_USE_SYSTEM_PACKAGE_REGISTRY=FALSE
		-DCMAKE_IGNORE_PATH=TRUE
		-DCMAKE_IGNORE_PREFIX_PATH=TRUE
		-DCMAKE_SYSTEM_IGNORE_PATH=TRUE
		-DCMAKE_SYSTEM_IGNORE_PREFIX_PATH=TRUE
		-DLibXml2_ROOT=${LIBXML2}
		-DBUILD_TESTING=OFF 
		-DENABLE_ACL=ON
		-DENABLE_BZip2=${BZIP2}
		-DENABLE_CAT=ON
		-DENABLE_CAT_SHARED=OFF
		-DENABLE_CNG=${LIBBCRYPT}
		-DENABLE_COVERAGE=OFF
		-DENABLE_CPIO=ON
		-DENABLE_CPIO_SHARED=OFF
		-DENABLE_EXPAT=${LIBEXPAT}
		-DENABLE_ICONV=${LIBICONV}
		-DENABLE_INSTALL=OFF
		-DENABLE_LIBB2=${LIBB2} 
		-DENABLE_LIBGCC=${LIBGCC}
		-DENABLE_LIBXML2=${LIBXML2} 
		-DENABLE_LZ4=${LZ4} 
		-DENABLE_LZMA=${XZ}
		-DENABLE_LZO=${LZO}
		-DENABLE_MBEDTLS=OFF
		-DENABLE_NETTLE=OFF
		-DENABLE_OPENSSL=${OPENSSL}
		-DENABLE_PCREPOSIX=OFF
		-DENABLE_SAFESEH="AUTO"
		-DENABLE_TAR=ON
		-DENABLE_TAR_SHARED=OFF
		-DENABLE_TEST=OFF
		-DENABLE_UNZIP=OFF
		-DENABLE_UNZIP_SHARED=OFF
		-DENABLE_WERROR=OFF
		-DENABLE_XATTR=ON
		-DENABLE_ZLIB=${ZLIB}
		-DENABLE_ZSTD=${ZSTD}
		-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR}
		-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
		-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR}
		-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES}
		-DLIBXML2_XMLLINT_EXECUTABLE=OFF
		-DPOSIX_REGEX_LIB="AUTO"
		-DUSE_BZIP2_DLL=OFF
		-DUSE_BZIP2_STATIC=ON
		-DWINDOWS_VERSION="WIN10"
		-DZLIB_DLL=OFF
		${BZIP2_CMAKE}
		${LIBB2_CMAKE}
		${LIBBCRYPT_CMAKE}
		${LIBEXPAT_CMAKE}
		${LIBICONV_CMAKE}
		${LIBXML2_CMAKE}
		${LZ4_CMAKE}
		${LZO_CMAKE}
		${OPENSSL_CMAKE}
		${PCRE2_CMAKE}
		${XZ_CMAKE}
		${ZLIB_CMAKE}
		${ZSTD_CMAKE}
		${LIBARCHIVE})
endif()


### COMPILE ###
dk_build(${LIBARCHIVE} archive_static)
