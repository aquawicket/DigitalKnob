# https://github.com/libarchive/libarchive
#
# INSTALL TARGETS given no BUNDLE DESTINATION for MACOSX_BUNDLE executabletarget "bsdcat".
# https://github.com/libarchive/libarchive/issues/1563


### DEPENDS ###
dk_depend(bzip2)
dk_depend(cryptopp)
dk_depend(libexpat)
dk_depend(libiconv)
dk_depend(libxml2)
dk_depend(openssl)
dk_depend(xz)
dk_depend(zlib)
dk_depend(zstd)


### IMPORT ###
dk_import(https://github.com/libarchive/libarchive.git PATCH)


### LINK ###
dk_define				(LIBARCHIVE_STATIC)
dk_include				(${LIBARCHIVE}/libarchive)
dk_include				(${LIBARCHIVE}/${OS})
ANDROID_dk_include		(${LIBARCHIVE}/contrib/android/include)
WIN_dk_libDebug			(${LIBARCHIVE}/${OS}/libarchive/${DEBUG_DIR}/archive_static.lib)
WIN_dk_libRelease		(${LIBARCHIVE}/${OS}/libarchive/${RELEASE_DIR}/archive_static.lib)
APPLE_dk_libDebug		(${LIBARCHIVE}/${OS}/libarchive/${DEBUG_DIR}/libarchive.a)
APPLE_dk_libRelease		(${LIBARCHIVE}/${OS}/libarchive/${RELEASE_DIR}/libarchive.a)
LINUX_dk_libDebug		(${LIBARCHIVE}/${OS}/${DEBUG_DIR}/libarchive/libarchive.a)
LINUX_dk_libRelease		(${LIBARCHIVE}/${OS}/${RELEASE_DIR}/libarchive/libarchive.a)
RASPBERRY_dk_libDebug	(${LIBARCHIVE}/${OS}/${DEBUG_DIR}/libarchive/libarchive.a)
RASPBERRY_dk_libRelease	(${LIBARCHIVE}/${OS}/${RELEASE_DIR}/libarchive/libarchive.a)
ANDROID_dk_libDebug		(${LIBARCHIVE}/${OS}/libarchive/${DEBUG_DIR}/libarchive.a)
ANDROID_dk_libRelease	(${LIBARCHIVE}/${OS}/libarchive/${RELEASE_DIR}/libarchive.a)
EMSCRIPTEN_dk_libDebug	(${LIBARCHIVE}/${OS}/${DEBUG_DIR}/libarchive/libarchive.a)
EMSCRIPTEN_dk_libRelease(${LIBARCHIVE}/${OS}/${RELEASE_DIR}/libarchive/libarchive.a)

### GENERATE ###
WIN_dk_queueCommand(${DKCMAKE_BUILD}
	-DBUILD_TESTING=OFF
	#-DENABLE_ACL=OFF 
	#-DENABLE_BZip2=ON
	#-DENABLE_CPIO=OFF 
	#-DENABLE_CNG=OFF
	#-DENABLE_EXPAT=OFF
	#-DENABLE_ICONV=OFF
	#-DENABLE_NETTLE=OFF
	#-DENABLE_LIBB2=OFF 
	#-DENABLE_LibGCC=OFF 
	#-DENABLE_LZ4=OFF 
	#-DENABLE_PCREPOSIX=OFF
	#-DENABLE_TEST=OFF
	#-DENABLE_WERROR=OFF
	#-DENABLE_XATTR=OFF
	#-DENABLE_ZSTD=OFF 
	#-DEXPAT_INCLUDE_DIR=OFF 
	#-DEXPAT_LIBRARY=OFF
	#-DUSE_BZIP2_STATIC=ON
	#-DUSE_BZIP2_DLL=OFF
	-DWINDOWS_VERSION=WIN10
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${OPENSSL_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})

MAC_dk_queueCommand(${DKCMAKE_BUILD}
	-DBUILD_TESTING=OFF 
	-DENABLE_ACL=OFF 
	-DENABLE_BZip2=OFF 
	-DENABLE_CNG=OFF 
	-DENABLE_CPIO=OFF 
	-DENABLE_ICONV=OFF
	-DENABLE_LZ4=OFF
	-DENABLE_NETTLE=OFF 
	-DENABLE_OPENSSL=OFF 
	-DENABLE_TEST=OFF 
	-DENABLE_XATTR=OFF 
	-DENABLE_ZSTD=OFF 
	-DEXPAT_INCLUDE_DIR=OFF 
	-DEXPAT_LIBRARY=OFF 
	-DICONV_INCLUDE_DIR=OFF 
	-DLIBXML2_INCLUDE_DIR=OFF 
	-DLIBXML2_LIBRARIES=OFF 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DLZO2_INCLUDE_DIR=OFF 
	-DLZO2_LIBRARY=OFF 
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${OPENSSL_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})

IOS_dk_queueCommand(${DKCMAKE_BUILD}
	-DBUILD_TESTING=OFF 
	"-DCMAKE_C_FLAGS=-I${LIBARCHIVE}/libarchive" 
	-DENABLE_ACL=OFF 
	-DENABLE_BZip2=OFF 
	-DENABLE_CAT=OFF 
	-DENABLE_CNG=OFF 
	-DENABLE_CPIO=OFF 
	-DENABLE_ICONV=OFF 
	-DENABLE_NETTLE=OFF 
	-DENABLE_OPENSSL=OFF 
	-DENABLE_TAR=OFF 
	-DENABLE_TEST=OFF 
	-DENABLE_WERROR=0 
	-DENABLE_XATTR=OFF 
	-DEXPAT_INCLUDE_DIR=OFF 
	-DEXPAT_LIBRARY=OFF 
	-DICONV_INCLUDE_DIR=OFF 
	-DIOS=TRUE 
	-DLIBXML2_INCLUDE_DIR=OFF 
	-DLIBXML2_LIBRARIES=OFF 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF 
	-DLZO2_INCLUDE_DIR=OFF 
	-DLZO2_LIBRARY=OFF 
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${OPENSSL_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})
if(IOS)
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#include <time.h>\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "typedef int errno_t;\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "typedef time_t __time64_t;\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#undef HAVE__GMTIME64_S\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#undef HAVE__CTIME64_S\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#undef HAVE_FUTIMESAT\n")
endif()

IOSSIM_dk_queueCommand(${DKCMAKE_BUILD}
	-DBUILD_TESTING=OFF 
	"-DCMAKE_C_FLAGS=-I${LIBARCHIVE}/libarchive" 
	-DENABLE_ACL=OFF 
	-DENABLE_CAT=OFF 
	-DENABLE_CNG=OFF 
	-DENABLE_CPIO=OFF 
	-DENABLE_ICONV=OFF 
	-DENABLE_NETTLE=OFF 
	-DENABLE_OPENSSL=OFF 
	-DENABLE_TAR=OFF 
	-DENABLE_TEST=OFF 
	-DENABLE_WERROR=0 
	-DENABLE_XATTR=OFF 
	-DEXPAT_INCLUDE_DIR=OFF 
	-DEXPAT_LIBRARY=OFF 
	-DICONV_INCLUDE_DIR=OFF 
	-DIOS=TRUE -DENABLE_BZip2=OFF 
	-DLIBXML2_INCLUDE_DIR=OFF 
	-DLIBXML2_LIBRARIES=OFF 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF 
	-DLZO2_INCLUDE_DIR=OFF 
	-DLZO2_LIBRARY=OFF 
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${OPENSSL_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})
if(IOSSIM)
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#include <time.h>\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "typedef int errno_t;\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "typedef time_t __time64_t;\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#undef HAVE__GMTIME64_S\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#undef HAVE__CTIME64_S\n")
	file(APPEND ${LIBARCHIVE}/${OS}/config.h "#undef HAVE_FUTIMESAT\n")
endif()

LINUX_dk_queueCommand(${DKCMAKE_BUILD}
	-DBUILD_TESTING=OFF 
	-DENABLE_ACL=OFF 
	-DENABLE_CNG=OFF 
	-DENABLE_CPIO=OFF 
	-DENABLE_ICONV=OFF 
	-DENABLE_NETTLE=OFF 
	-DENABLE_OPENSSL=OFF 
	-DENABLE_TEST=OFF 
	-DENABLE_XATTR=OFF 
	-DEXPAT_INCLUDE_DIR=OFF 
	-DEXPAT_LIBRARY=OFF 
	-DICONV_INCLUDE_DIR=OFF 
	-DLIBXML2_INCLUDE_DIR=OFF 
	-DLIBXML2_LIBRARIES=OFF 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF 
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${OPENSSL_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})

RASPBERRY_dk_queueCommand(${DKCMAKE_BUILD}
	-DBUILD_TESTING=OFF 
	-DENABLE_ACL=OFF 
	-DENABLE_CNG=OFF 
	-DENABLE_CPIO=OFF 
	-DENABLE_ICONV=OFF 
	-DENABLE_NETTLE=OFF 
	-DENABLE_OPENSSL=OFF 
	-DENABLE_TEST=OFF 
	-DENABLE_XATTR=OFF 
	-DEXPAT_INCLUDE_DIR=OFF 
	-DEXPAT_LIBRARY=OFF 
	-DICONV_INCLUDE_DIR=OFF 
	-DLIBXML2_INCLUDE_DIR=OFF 
	-DLIBXML2_LIBRARIES=OFF 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF 
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${OPENSSL_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})

ANDROID_dk_queueCommand(${DKCMAKE_BUILD}
	-DBUILD_TESTING=OFF 
	"-DCMAKE_C_FLAGS=-I${LIBARCHIVE}/${OS} -I${LIBARCHIVE}/contrib/android/include -I${ZLIB}/${OS}" 
	-DENABLE_ACL=OFF 
	-DENABLE_BZip2=OFF 
	-DENABLE_CAT=OFF 
	-DENABLE_CNG=OFF 
	-DENABLE_CPIO=OFF 
	-DENABLE_EXPAT=OFF 
	-DENABLE_ICONV=OFF 
	-DENABLE_LIBB2=OFF 
	-DENABLE_LIBXML2=OFF 
	-DENABLE_LZ4=OFF 
	-DENABLE_LibGCC=OFF 
	-DENABLE_NETTLE=OFF 
	-DENABLE_OPENSSL=OFF 
	-DENABLE_PCREPOSIX=OFF 
	-DENABLE_TAR=OFF 
	-DENABLE_TEST=OFF 
	-DENABLE_XATTR=OFF 
	-DENABLE_ZSTD=OFF 
	-DEXPAT_INCLUDE_DIR=OFF 
	-DEXPAT_LIBRARY=OFF 
	-DICONV_INCLUDE_DIR=OFF 
	-DLIBXML2_INCLUDE_DIR=OFF 
	-DLIBXML2_LIBRARIES=OFF 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF 
	-DUSE_BZIP2_DLL=OFF 
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${OPENSSL_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})

EMSCRIPTEN_dk_queueCommand(${DKCMAKE_BUILD}
	-DBUILD_TESTING=OFF
	-DENABLE_ACL=OFF
	-DENABLE_CNG=OFF
	-DENABLE_CPIO=OFF
	-DENABLE_ICONV=OFF 
	-DENABLE_NETTLE=OFF 
	-DENABLE_OPENSSL=OFF 
	-DENABLE_TEST=OFF 
	-DENABLE_XATTR=OFF
	-DEXPAT_INCLUDE_DIR=OFF 
	-DEXPAT_LIBRARY=OFF
	-DICONV_INCLUDE_DIR=OFF 
	-DLIBXML2_INCLUDE_DIR=OFF 
	-DLIBXML2_LIBRARIES=OFF 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF 
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${OPENSSL_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE}
	${LIBARCHIVE})


### COMPILE ###
dk_build(${LIBARCHIVE} archive_static)
