include(${DKCMAKE_FUNCTIONS_DIR}/DK.cmake)
dk_load(dk_builder)
# Multi-format archive and compression library
#
# https://libarchive.org/
# https://github.com/libarchive/libarchive
# https://packages.msys2.org/base/libarchive
#
# INSTALL TARGETS given no BUNDLE DESTINATION for MACOSX_BUNDLE executabletarget "bsdcat".
# https://github.com/libarchive/libarchive/issues/1563


### DEPENDS ###
dk_depend(bzip2)
#dk_depend(libb2)
#dk_depend(libbcrypt)
dk_depend(libexpat)
dk_depend(libgcc)
dk_depend(libiconv)
dk_depend(libxml2)
dk_depend(lz4)
dk_depend(lzo)
dk_depend(pcre2)
dk_depend(xz)
dk_depend(zlib)
dk_depend(zstd)


### IMPORT ###
#dk_import(https://github.com/libarchive/libarchive.git)
dk_import(https://github.com/libarchive/libarchive/archive/refs/heads/master.zip)



### LINK ###
dk_define					(LIBARCHIVE_STATIC)
dk_include					(${LIBARCHIVE_DIR}/libarchive)
dk_include					(${LIBARCHIVE_TRIPLE_DIR})
ANDROID_dk_include			(${LIBARCHIVE_DIR}/contrib/android/include)

if(MULTI_CONFIG)
	if(MSVC)
		WIN_dk_libDebug		(${LIBARCHIVE_TRIPLE_DIR}/libarchive/${DEBUG_DIR}/archive.lib)
		WIN_dk_libRelease	(${LIBARCHIVE_TRIPLE_DIR}/libarchive/${RELEASE_DIR}/archive.lib)
	else()
		dk_libDebug			(${LIBARCHIVE_TRIPLE_DIR}/libarchive/${DEBUG_DIR}/libarchive.a)
		dk_libRelease		(${LIBARCHIVE_TRIPLE_DIR}/libarchive/${RELEASE_DIR}/libarchive.a)
	endif()
else()
	dk_libDebug				(${LIBARCHIVE_TRIPLE_DIR}/${DEBUG_DIR}/libarchive/libarchive.a)
	dk_libRelease			(${LIBARCHIVE_TRIPLE_DIR}/${RELEASE_DIR}/libarchive/libarchive.a)
endif()


### GENERATE ###
ANDROID_dk_configure(${LIBARCHIVE_DIR}
	"-DCMAKE_C_FLAGS=-I${LIBARCHIVE_TRIPLE_DIR} -I${LIBARCHIVE_DIR}/contrib/android/include"
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	#-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR}
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=${BZIP2}
	#-DWINDOWS_VERSION=""
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBGCC_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	#${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE})

EMSCRIPTEN_dk_configure(${LIBARCHIVE_DIR}
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=ON
	#-DWINDOWS_VERSION="WIN10"
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBGCC_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE})
	
IOS_dk_configure(${LIBARCHIVE_DIR}
	"-DCMAKE_C_FLAGS=-I${LIBARCHIVE_DIR}/libarchive" 
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=ON
	#-DWINDOWS_VERSION="WIN10"
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBGCC_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE})
if(IOS)
	dk_fileAppend(${LIBARCHIVE_TRIPLE_DIR}/config.h "#include <time.h>\n")
	dk_fileAppend(${LIBARCHIVE_TRIPLE_DIR}/config.h "typedef int errno_t;\n")
	dk_fileAppend(${LIBARCHIVE_TRIPLE_DIR}/config.h "typedef time_t __time64_t;\n")
	dk_fileAppend(${LIBARCHIVE_TRIPLE_DIR}/config.h "#undef HAVE__GMTIME64_S\n")
	dk_fileAppend(${LIBARCHIVE_TRIPLE_DIR}/config.h "#undef HAVE__CTIME64_S\n")
	dk_fileAppend(${LIBARCHIVE_TRIPLE_DIR}/config.h "#undef HAVE_FUTIMESAT\n")
endif()

IOSSIM_dk_configure(${LIBARCHIVE_DIR}
	"-DCMAKE_C_FLAGS=-I${LIBARCHIVE_DIR}/libarchive"
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=ON
	#-DWINDOWS_VERSION="WIN10"
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBGCC_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE})
if(IOSSIM)
	dk_fileAppend(${LIBARCHIVE_TRIPLE_DIR}/config.h "#include <time.h>\n")
	dk_fileAppend(${LIBARCHIVE_TRIPLE_DIR}/config.h "typedef int errno_t;\n")
	dk_fileAppend(${LIBARCHIVE_TRIPLE_DIR}/config.h "typedef time_t __time64_t;\n")
	dk_fileAppend(${LIBARCHIVE_TRIPLE_DIR}/config.h "#undef HAVE__GMTIME64_S\n")
	dk_fileAppend(${LIBARCHIVE_TRIPLE_DIR}/config.h "#undef HAVE__CTIME64_S\n")
	dk_fileAppend(${LIBARCHIVE_TRIPLE_DIR}/config.h "#undef HAVE_FUTIMESAT\n")
endif()

LINUX_dk_configure(${LIBARCHIVE_DIR}
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=ON
	#-DWINDOWS_VERSION="WIN10"
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBGCC_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE})

MAC_dk_configure(${LIBARCHIVE_DIR}
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=ON
	#-DWINDOWS_VERSION="WIN10"
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBGCC_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE})
	
RASPBERRY_dk_configure(${LIBARCHIVE_DIR}
	-DENABLE_ACL=ON
	-DENABLE_BZip2=${BZIP2}
	-DENABLE_CAT=ON
	-DENABLE_CAT_SHARED=OFF
	-DENABLE_CNG=${LIBBCRYPT}
	-DENABLE_COVERAGE=OFF
	-DENABLE_CPIO=ON
	-DENABLE_CPIO_SHARED=OFF
	-DENABLE_EXPAT=${LIBEXPAT}
	-DENABLE_ICONV=${LIBICONV}
	-DENABLE_INSTALL=OFF
	-DENABLE_LIBB2=${LIBB2} 
	-DENABLE_LIBGCC=${LIBGCC}
	-DENABLE_LIBXML2=${LIBXML2} 
	-DENABLE_LZ4=${LZ4} 
	-DENABLE_LZMA=${XZ}
	-DENABLE_LZO=${LZO}
	-DENABLE_MBEDTLS=OFF
	-DENABLE_NETTLE=OFF
	-DENABLE_OPENSSL=${OPENSSL}
	-DENABLE_PCREPOSIX=OFF
	-DENABLE_SAFESEH="AUTO"
	-DENABLE_TAR=ON
	-DENABLE_TAR_SHARED=OFF
	-DENABLE_TEST=OFF
	-DENABLE_UNZIP=OFF
	-DENABLE_UNZIP_SHARED=OFF
	-DENABLE_WERROR=OFF
	-DENABLE_XATTR=ON
	-DENABLE_ZLIB=${ZLIB}
	-DENABLE_ZSTD=${ZSTD}
	-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR} 
	-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
	-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR} 
	-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES} 
	-DLIBXML2_XMLLINT_EXECUTABLE=OFF
	-DPOSIX_REGEX_LIB="AUTO"
	-DUSE_BZIP2_DLL=OFF
	-DUSE_BZIP2_STATIC=ON
	#-DWINDOWS_VERSION="WIN10"
	${BZIP2_CMAKE}
	${CRYPTOPP_CMAKE}
	${LIBB2_CMAKE}
	${LIBBCRYPT_CMAKE}
	${LIBEXPAT_CMAKE}
	${LIBGCC_CMAKE}
	${LIBICONV_CMAKE}
	${LIBXML2_CMAKE}
	${LZ4_CMAKE}
	${LZO_CMAKE}
	${OPENSSL_CMAKE}
	${PCRE2_CMAKE}
	${XZ_CMAKE}
	${ZLIB_CMAKE}
	${ZSTD_CMAKE})

if(MSVC)
	WIN_dk_configure(${LIBARCHIVE_DIR}
		-DENABLE_ACL=ON
		-DENABLE_BZip2=${BZIP2}
		-DENABLE_CAT=ON
		-DENABLE_CAT_SHARED=OFF
		-DENABLE_CNG=${LIBBCRYPT}
		-DENABLE_COVERAGE=OFF
		-DENABLE_CPIO=ON
		-DENABLE_CPIO_SHARED=OFF
		-DENABLE_EXPAT=${LIBEXPAT}
		-DENABLE_ICONV=${LIBICONV}
		-DENABLE_INSTALL=OFF
		-DENABLE_LIBB2=${LIBB2} 
		-DENABLE_LIBGCC=${LIBGCC}
		-DENABLE_LIBXML2=${LIBXML2} 
		-DENABLE_LZ4=${LZ4} 
		-DENABLE_LZMA=${XZ}
		-DENABLE_LZO=${LZO}
		-DENABLE_MBEDTLS=OFF
		-DENABLE_NETTLE=OFF
		-DENABLE_OPENSSL=${OPENSSL}
		-DENABLE_PCREPOSIX=OFF
		-DENABLE_SAFESEH="AUTO"
		-DENABLE_TAR=ON
		-DENABLE_TAR_SHARED=OFF
		-DENABLE_TEST=OFF
		-DENABLE_UNZIP=OFF
		-DENABLE_UNZIP_SHARED=OFF
		-DENABLE_WERROR=OFF
		-DENABLE_XATTR=ON
		-DENABLE_ZLIB=${ZLIB}
		-DENABLE_ZSTD=${ZSTD}
		-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR}
		-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR}
		-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR}
		-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES}
		-DLIBXML2_XMLLINT_EXECUTABLE=OFF
		-DPOSIX_REGEX_LIB="AUTO"
		-DUSE_BZIP2_DLL=OFF
		-DUSE_BZIP2_STATIC=ON
		-DWINDOWS_VERSION="WIN10"
		${BZIP2_CMAKE}
		${CRYPTOPP_CMAKE}
		${LIBB2_CMAKE}
		${LIBBCRYPT_CMAKE}
		${LIBEXPAT_CMAKE}
		${LIBGCC_CMAKE}
		${LIBICONV_CMAKE}
		${LIBXML2_CMAKE}
		${LZ4_CMAKE}
		${LZO_CMAKE}
		${OPENSSL_CMAKE}
		${PCRE2_CMAKE}
		${XZ_CMAKE}
		${ZLIB_CMAKE}
		${ZSTD_CMAKE})
else()
	WIN_dk_configure(${LIBARCHIVE_DIR}
		"-DCMAKE_C_FLAGS=-DLIBXML_STATIC"
		-DCMAKE_FIND_USE_CMAKE_PATH=FALSE
		-DCMAKE_FIND_USE_CMAKE_ENVIRONMENT_PATH=FALSE
		-DCMAKE_FIND_USE_SYSTEM_ENVIRONMENT_PATH=FALSE
		-DCMAKE_FIND_USE_PACKAGE_REGISTRY=FALSE
		-DCMAKE_FIND_USE_CMAKE_SYSTEM_PATH=FALSE
		-DCMAKE_FIND_USE_SYSTEM_PACKAGE_REGISTRY=FALSE
		-DCMAKE_IGNORE_PATH=TRUE
		-DCMAKE_IGNORE_PREFIX_PATH=TRUE
		-DCMAKE_SYSTEM_IGNORE_PATH=TRUE
		-DCMAKE_SYSTEM_IGNORE_PREFIX_PATH=TRUE
		-DLibXml2_ROOT=${LIBXML2}
		-DENABLE_ACL=ON
		-DENABLE_BZip2=${BZIP2}
		-DENABLE_CAT=ON
		-DENABLE_CAT_SHARED=OFF
		-DENABLE_CNG=${LIBBCRYPT}
		-DENABLE_COVERAGE=OFF
		-DENABLE_CPIO=ON
		-DENABLE_CPIO_SHARED=OFF
		-DENABLE_EXPAT=${LIBEXPAT}
		-DENABLE_ICONV=${LIBICONV}
		-DENABLE_INSTALL=OFF
		-DENABLE_LIBB2=${LIBB2} 
		#-DENABLE_LIBGCC=${LIBGCC}
		-DENABLE_LIBXML2=${LIBXML2} 
		-DENABLE_LZ4=${LZ4} 
		-DENABLE_LZMA=${XZ}
		-DENABLE_LZO=${LZO}
		-DENABLE_MBEDTLS=OFF
		-DENABLE_NETTLE=OFF
		-DENABLE_OPENSSL=${OPENSSL}
		-DENABLE_PCREPOSIX=OFF
		-DENABLE_SAFESEH="AUTO"
		-DENABLE_TAR=ON
		-DENABLE_TAR_SHARED=OFF
		-DENABLE_TEST=OFF
		-DENABLE_UNZIP=OFF
		-DENABLE_UNZIP_SHARED=OFF
		-DENABLE_WERROR=OFF
		-DENABLE_XATTR=ON
		-DENABLE_ZLIB=${ZLIB}
		-DENABLE_ZSTD=${ZSTD}
		-DEXPAT_INCLUDE_DIR=${LIBEXPAT_INCLUDE_DIR}
		-DICONV_INCLUDE_DIR=${LIBICONV_INCLUDE_DIR} 
		-DLIBXML2_INCLUDE_DIR=${LIBXML2_INCLUDE_DIR}
		-DLIBXML2_LIBRARIES=${LIBXML2_LIBRARIES}
		-DLIBXML2_XMLLINT_EXECUTABLE=OFF
		-DPOSIX_REGEX_LIB="AUTO"
		-DUSE_BZIP2_DLL=OFF
		-DUSE_BZIP2_STATIC=ON
		-DWINDOWS_VERSION="WIN10"
		-DZLIB_DLL=OFF
		${BZIP2_CMAKE}
		${LIBB2_CMAKE}
		${LIBBCRYPT_CMAKE}
		${LIBEXPAT_CMAKE}
		${LIBGCC_CMAKE}
		${LIBICONV_CMAKE}
		${LIBXML2_CMAKE}
		${LZ4_CMAKE}
		${LZO_CMAKE}
		${OPENSSL_CMAKE}
		${PCRE2_CMAKE}
		${XZ_CMAKE}
		${ZLIB_CMAKE}
		${ZSTD_CMAKE})
endif()


### COMPILE ###
dk_build(${LIBARCHIVE_DIR} archive_static)
